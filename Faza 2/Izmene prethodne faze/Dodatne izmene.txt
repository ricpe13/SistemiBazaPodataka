DROP TABLE SEF;

DROP TABLE GRUPA_RADNIKA;

DROP TABLE RADNIK;

DROP TABLE PARK;

CREATE TABLE RADNIK (
IDR NUMBER(4,0) PRIMARY KEY,
IME VARCHAR2(10) NOT NULL,
PREZIME VARCHAR2(20) NOT NULL,
JMBG VARCHAR2(13) NOT NULL UNIQUE,
CHECK(LENGTH(JMBG)=13),
ADRESA VARCHAR(30) NOT NULL,
BRRADNEKNJIZICE NUMBER(10,0) NOT NULL UNIQUE,
IMERODITELJA VARCHAR2(15) NOT NULL,
STRUCNASPREMA VARCHAR2(15) NOT NULL,
DATUMRODJ DATE NOT NULL,
ZAZELENILO NUMBER(1,0) NOT NULL,
ZAHIGIJENU NUMBER(1,0) NOT NULL,
ZAOBJEKAT NUMBER(1,0) NOT NULL,
IDZP NUMBER (4,0) NOT NULL,
IDGRUPE NUMBER (4,0) NOT NULL
);

CREATE TABLE GRUPA_RADNIKA (
IDG NUMBER (4,0) PRIMARY KEY,
NAZIVG VARCHAR2(100) NOT NULL,
IDPARKA NUMBER (4,0) NOT NULL
);

CREATE TABLE SEF (
IDRAD NUMBER(4,0) PRIMARY KEY,
CONSTRAINT IDS FOREIGN KEY (IDRAD) REFERENCES RADNIK(IDR),
MATBR VARCHAR2(13) NOT NULL UNIQUE,
CHECK (LENGTH(MATBR)=13),
IDGRUPE NUMBER (4,0) NOT NULL
);

CREATE TABLE PARK (
IDZ NUMBER (4,0) PRIMARY KEY,
NAZIVP VARCHAR2(30) NOT NULL,
POVRSINAP NUMBER(5,2) NOT NULL,
BROJOBJEKATA NUMBER (4,0) NOT NULL,
CONSTRAINT IDZP FOREIGN KEY (IDZ) REFERENCES ZELENA_POVRSINA(IDZ) 
);

ALTER TABLE PARK 
MODIFY BROJOBJEKATA DEFAULT 0;

CREATE TABLE OBJEKAT (
IDO NUMBER (4,0) PRIMARY KEY,
IDPARKA NUMBER (4,0) NOT NULL,
REDNIBR NUMBER (4,0) NOT NULL,
TIP VARCHAR2 (20) NOT NULL,
CONSTRAINT OBJP FOREIGN KEY (IDPARKA) REFERENCES PARK(IDZ)
);

ALTER TABLE OBJEKAT 
ADD CONSTRAINT CHECK_TIP CHECK (TIP IN ('klupa', 'drvo', 'zasticeni objekat', 'decije igraliste', 'svetiljka', 'fontana'));

CREATE SEQUENCE OBJEKAT_ID_SEQ
    MINVALUE 1
    INCREMENT BY 1
    START WITH 1
    MAXVALUE 9999999999999999999999999999
    CACHE 20
    ORDER
    NOCYCLE;

CREATE OR REPLACE TRIGGER "OBJEKAT_PK" 
    BEFORE INSERT
    ON OBJEKAT
    REFERENCING NEW AS NEW
    FOR EACH ROW
BEGIN
    SELECT OBJEKAT_ID_SEQ.NEXTVAL INTO :NEW.IDO FROM DUAL;
END;

CREATE OR REPLACE TRIGGER BROJI_OBJEKTE
AFTER INSERT OR DELETE ON OBJEKAT
FOR EACH ROW

BEGIN
    IF INSERTING THEN
        
        UPDATE PARK
        SET BROJOBJEKATA = BROJOBJEKATA + 1;
    ELSIF DELETING THEN
       
        UPDATE PARK
        SET BROJOBJEKATA = BROJOBJEKATA - 1;
    END IF;
END;

CREATE SEQUENCE REDNIBR_SEQ
    MINVALUE 1
    INCREMENT BY 1
    START WITH 1
    MAXVALUE 9999999999999999999999999999
    CACHE 20
    ORDER
    NOCYCLE;
    
    CREATE OR REPLACE TRIGGER REDNIBROJOJEKATA 
    BEFORE INSERT
    ON OBJEKAT
    REFERENCING NEW AS NEW
    FOR EACH ROW
BEGIN
    SELECT REDNIBR_SEQ.NEXTVAL INTO :NEW.REDNIBR FROM DUAL;
END;








DROP TABLE KLUPA;

CREATE TABLE KLUPA (
IDO NUMBER (4,0) PRIMARY KEY,
MATERIJAL VARCHAR2 (15) NOT NULL,
CONSTRAINT KO FOREIGN KEY (IDO) REFERENCES OBJEKAT (IDO) ON DELETE CASCADE
);

DROP TABLE DECIJE_IGRALISTE;

CREATE TABLE DECIJE_IGRALISTE (
IDO NUMBER (4,0) PRIMARY KEY,
REDNIBR NUMBER (4,0) NOT NULL,
BRIGRACAKA NUMBER (2,0) NOT NULL,
PESAK NUMBER(1,0) NOT NULL,
STAROST NUMBER(2,0) NOT NULL,
CONSTRAINT DIO FOREIGN KEY (IDO) REFERENCES OBJEKAT (IDO) ON DELETE CASCADE
);

DROP TABLE SVETILJKA;

CREATE TABLE SVETILJKA (
IDO NUMBER (4,0) PRIMARY KEY,
BRSIJALICA NUMBER (4,0) NOT NULL,
CONSTRAINT SVO FOREIGN KEY (IDO) REFERENCES OBJEKAT (IDO) ON DELETE CASCADE
);

DROP TABLE FONTANA;

CREATE TABLE FONTANA (
IDO NUMBER (4,0) PRIMARY KEY,
BRPRSKALICA NUMBER (4,0) NOT NULL,
POVRSINAF NUMBER (4,0) NOT NULL,
CONSTRAINT FO FOREIGN KEY (IDO) REFERENCES OBJEKAT (IDO) ON DELETE CASCADE
);

DROP TABLE DRVO;

CREATE TABLE DRVO (
IDO NUMBER (4,0) PRIMARY KEY,
VISINAKROSNJE NUMBER (4,2) NOT NULL,
VRSTA VARCHAR2(20) NOT NULL,
DATUMSADNJE DATE NOT NULL,
POVRSINAK NUMBER(5,2) NOT NULL,
OBIMDEBLA NUMBER(5,2) NOT NULL,
IDZASTITE NUMBER (4,0) NOT NULL,
CONSTRAINT DO FOREIGN KEY (IDO) REFERENCES OBJEKAT (IDO) ON DELETE CASCADE,
CONSTRAINT DZ FOREIGN KEY (IDZASTITE) REFERENCES ZASTITA(IDZASTITE)
);

DROP TABLE SKULPTURA;

CREATE TABLE SKULPTURA(
IDO NUMBER (4,0) PRIMARY KEY,
AUTOR VARCHAR2 (30) NOT NULL,
IDZO NUMBER (4,0) NOT NULL,
CONSTRAINT SKULO FOREIGN KEY (IDO) REFERENCES OBJEKAT (IDO) ON DELETE CASCADE
);

DROP TABLE SPOMENIK;

CREATE TABLE SPOMENIK (
IDO NUMBER (4,0) PRIMARY KEY,
NAZIVS VARCHAR2 (30) NOT NULL,
IDZO NUMBER (4,0) NOT NULL,
CONSTRAINT SPOMO FOREIGN KEY (IDO) REFERENCES OBJEKAT (IDO) ON DELETE CASCADE
);